<!DOCTYPE html>
<html lang="en">
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0YLTCV2MMS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0YLTCV2MMS');
</script>
    <!--Tab name and icon-->
    <link rel="icon" type="image/x-icon" href="/img/favicon.ico" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sfms Games</title>
    <link rel="stylesheet" href="assets/style.css">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
    <script
  async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1609993827735056"
  crossorigin="anonymous"
></script>
    <script type="module">
      // Keys for various games
      const polytrackKeys = [
        "v1_record_445edfa992d0b19b376c8072692f69eafc4afeceb608ba355d44b3cb57a902a0",
        "v1_record_55a26267e4fa6a176ba5898b3e1354d54bbf7c02ed0fd3f37e4e3cee56724a8a",
        "v1_record_60b9020ffd46fa428ce40ab2e610992d4bcd2df68f00005c6b88544ce134f950",
        "v1_record_764e05d5eb827c3b608b288cdffc3dc29be2abcc5d29cf958b029badf1564417",
        "v1_record_8b4383a77d1f900b5beff053aee8a1bc47a733778dac54f6ecca0dd6cffeec80",
        "v1_record_ed65907f59ece7a863e9f1ea1e2b50714920899f7d2e42d9b9656bcb8382b66a",
        "v1_record_f67a25877dbbdb5287f9191cda506a254b0ca7a95fde82e34951fe55bb04c172",
      ];
      const babelTowerKeys = [
        "Tower_id",
        "W_3_numGiftsAlreadyGiven",
        "W_3_timeOfNextGift",
        "save_version",
        "save_date",
        "save_data",
      ];
      const idleSharkKey = ["sharkGameSave"];
      const cookieClickerKey = ["CookieClickerGame"];
      const badEggKeys = [
        "vms--u",
        "vms--logger-settings",
        "vms--reload-manager-enabled",
        "vms--mod-geo",
        "vms--vm-abd",
      ];

      function getParsedItem(key) {
        const item = localStorage.getItem(key);
        try {
          return JSON.parse(item);
        } catch (error) {
          console.warn(`Invalid JSON for key: ${key} Error: ${error}`);
          return item;
        }
      }

      function copyText(text) {
        navigator.clipboard
          .writeText(text)
          .then(() => showTransferInstructions())
          .catch((err) =>
            alert(`Error: failed to copy your save data: ${err}`)
          );
      }

      function showTransferInstructions() {
        alert(
          "Your save data was successfully copied to your clipboard!\nTo transfer your save data to either strongdogxp.github.io or mathcordxp.github.io, please navigate to the home page of either website and in the red updates box, there will be further instruction.\n\nMAKE SURE to not copy anything to your clipboard before transferring your data!"
        );
      }

      function setDataInObject(dataObj) {
        Object.entries(dataObj).forEach(([key, value]) => {
          if (value !== null) {
            const finalValue =
              typeof value === "string" ? value : JSON.stringify(value);
            localStorage.setItem(key, finalValue);
          }
        });
      }

      function validateData(dataObj) {
        return Object.values(dataObj).every((value) => value !== null);
      }

      function getAndBundleDataIntoObj(keysArr) {
        const dataObj = Object.fromEntries(
          keysArr.map((key) => [key, getParsedItem(key)])
        );
        if (!validateData(dataObj))
          alert(
            "(If you retrieved Polytrack saves this isn't a problem, please move on)\n\nYour save data will be copied, but some could not be retrieved which may cause problems importing this data. Please ensure all required keys of your game save data are present in localStorage and try again.\n\nIf this issue persists, report the error to the bug report form or message us on Discord."
          );
        return JSON.stringify(dataObj);
      }

      function getDataAndCopy(keysArr) {
        const gameData = getAndBundleDataIntoObj(keysArr);
        if (gameData) copyText(gameData);
      }

      document.addEventListener("DOMContentLoaded", function () {
        if (window.location.hostname.includes("netlify.app")) {
          document.body.innerHTML = `
            <div style="padding: 20px; text-align: center; color: white; background-color: #333; font-family: Arial, sans-serif;">
              <p>Hi there! If you're seeing this, you're trying to connect to a StrongDog version hosted on Netlify. Due to Netlify's extreme costs, we're moving back to GitHub with updated links!</p>
              <p>Here are the new links that should be used from now on:</p>
              <p><a href="https://strongdogxp.github.io" style="color: orange;">strongdogxp.github.io</a></p>
              <p><a href="https://mathcordxp.github.io" style="color: orange;">mathcordxp.github.io</a></p>
              <p>If you used to use <strong>stroongdog.netlify.app</strong>, the updated GitHub link is on the Discord in the same place you found the original link.</p>
              <h2>Use these buttons to copy your save data from this page (just strongdog.netlify.app currently) to transfer it over to another StrongDogXP page:</h2>
              <button id="get-polytrack-data" style="background: orange; border-radius: 10px; padding: 1em; color: black; border: none; cursor: pointer;">Retrieve Polytrack Save Data</button>
              <button id="get-cookie-clicker-data" style="background: orange; border-radius: 10px; padding: 1em; color: black; border: none; cursor: pointer;">Retrieve Cookie Clicker Save Data</button>
              <button id="get-bad-egg-data" style="background: orange; border-radius: 10px; padding: 1em; color: black; border: none; cursor: pointer;">Retrieve Bad egg Save Data</button>
              <button id="get-babel-tower-data" style="background: orange; border-radius: 10px; padding: 1em; color: black; border: none; cursor: pointer;">Retrieve Babel Tower Save Data</button>
              <button id="get-idle-shark-data" style="background: orange; border-radius: 10px; padding: 1em; color: black; border: none; cursor: pointer;">Retrieve Idle Shark Save Data</button>
              <p>If you cannot figure out how to use these buttons or they simply don't work, report an error in the <a href="./about.html" target="_blank" style="color: deepskyblue">bug report form</a> or message us on Discord.</p>
              <h2><strong>DON'T FORGET TO SET NEW BOOKMARKS! THIS PAGE WILL BE GOING DOWN SOON!</strong></h2>
            </div>
          `;
          document.body.style =
            "height: 100vh; margin: 0; display: grid; place-items: center;";

          const getPolytrackDataBtn =
            document.getElementById("get-polytrack-data");
          const getCookieClickerDataBtn = document.getElementById(
            "get-cookie-clicker-data"
          );
          const getBadEggDataBtn = document.getElementById("get-bad-egg-data");
          const getBabelTowerDataBtn = document.getElementById(
            "get-babel-tower-data"
          );
          const getIdleSharkDataBtn = document.getElementById(
            "get-idle-shark-data"
          );

          getPolytrackDataBtn.addEventListener("click", () =>
            getDataAndCopy(polytrackKeys)
          );
          getCookieClickerDataBtn.addEventListener("click", () =>
            getDataAndCopy(cookieClickerKey)
          );
          getBadEggDataBtn.addEventListener("click", () =>
            getDataAndCopy(badEggKeys)
          );
          getBabelTowerDataBtn.addEventListener("click", () =>
            getDataAndCopy(babelTowerKeys)
          );
          getIdleSharkDataBtn.addEventListener("click", () =>
            getDataAndCopy(idleSharkKey)
          );
        } else {
          const importSaveDataBtn = document.getElementById(
            "import-save-data-btn"
          );
          importSaveDataBtn.addEventListener("click", () => {
            const confirmMessage = confirm(
              `IMPORTANT: note that by confirming this message, you will REWRITE ALL current save data (only on this page) for the game you chose to transfer the data from. If you have records on this page that you don't want to be overridden by records on the site you're transferring data from, cancel this message.\n\nAfter you dismiss this browser alert message, there may be a pop-up asking you to allow this page to "see text copied to the clipboard".\n\nTo be able to transfer your save data and continue, you MUST click ALLOW.`
            );
            if (!confirmMessage) return;
            navigator.clipboard
              .readText()
              .then((text) => {
                if (!text) {
                  throw new Error(
                    "Clipboard is empty. Please copy the data to the clipboard and try again."
                  );
                }

                let parsedData;
                try {
                  parsedData = JSON.parse(text);
                } catch (err) {
                  throw new Error(
                    "Failed to parse clipboard content as JSON. Ensure the data is in valid JSON format."
                  );
                }

                if (typeof parsedData !== "object") {
                  throw new Error(
                    "Invalid data format. The clipboard content must be a JSON object."
                  );
                }

                setDataInObject(parsedData);
                alert(
                  "Your data was successfully transferred! If there are any issues, please contact support."
                );
              })
              .catch((err) =>
                alert(`Failed to read clipboard contents: ${err}`)
              );
          });
        }
      });

      import games from "./cards-data.js";
      import { siteMapping } from "./site-mapping.js";

      function normalizeGameName(name) {
        return name
          .toLowerCase()
          .replace(/\s+/g, "")
          .replace(/[^a-z0-9]/g, "");
      }

      function getCurrentSiteKey() {
        const currentURL = window.location.href;
        const keys = Object.keys(siteMapping);
        keys.sort((a, b) => b.length - a.length);
        for (const key of keys) {
          if (currentURL.includes(key)) {
            return key;
          }
        }
        return null;
      }

      function getAdjustedUrls(href, imgSrc, page) {
        let adjustedHref = href;
        let adjustedImgSrc = `./img/${imgSrc}`;
        const currentSiteKey = getCurrentSiteKey();

        if (currentSiteKey) {
          const currentSitePages = siteMapping[currentSiteKey];
          const pageNumberToURL = {};
          let currentPageNumber = getPageNumberFromURL(currentSiteKey);
          pageNumberToURL[currentPageNumber] = currentSiteKey;

          if (currentSitePages) {
            currentSitePages.forEach((url) => {
              const pageNum = getPageNumberFromURL(url);
              pageNumberToURL[pageNum] = url;
            });
          }

          if (page !== undefined && page !== currentPageNumber) {
            let adjustedBaseURL = pageNumberToURL[page];
            if (!adjustedBaseURL) {
              const currentOrigin = window.location.origin;
              adjustedBaseURL = `${currentOrigin}/strongdog${page}`;
            }
            const adjustedGameHref = href.replace(/^\.\//, "");
            adjustedHref = `${adjustedBaseURL}/${adjustedGameHref}`;
            const adjustedImgPath = imgSrc.replace(/^\.\//, "");
            adjustedImgSrc = `${adjustedBaseURL}/img/${adjustedImgPath}`;
          }
        } else {
          if (page !== undefined && page > 1) {
            const currentOrigin = window.location.origin;
            const adjustedBaseURL = `${currentOrigin}/strongdog${page}`;
            const adjustedGameHref = href.replace(/^\.\//, "");
            adjustedHref = `${adjustedBaseURL}/${adjustedGameHref}`;
            const adjustedImgPath = imgSrc.replace(/^\.\//, "");
            adjustedImgSrc = `${adjustedBaseURL}/img/${adjustedImgPath}`;
          }
        }

        return { adjustedHref, adjustedImgSrc };
      }

      function getPageNumberFromURL(url) {
        const regex = /(strongdog|mathcord|stroongdog)(\d*)/;
        const match = url.match(regex);
        if (match) {
          const pageNum = match[2];
          return pageNum === "" ? 1 : parseInt(pageNum, 10);
        } else {
          return 1;
        }
      }

      function getCardHTML(gameObject) {
        const { href, imgSrc, name, page } = gameObject;
        const { adjustedHref, adjustedImgSrc } = getAdjustedUrls(
          href,
          imgSrc,
          page
        ); // Use original logic for image paths
        const gameLink = `./play/?id=${gameObject.id}`; // Adjusted to use game ID
        const normalizedName = normalizeGameName(name); // Normalize the game name
        return `
    <a href="${gameLink}" class="card" data-game-id="${normalizedName}" data-page="${page}">
        <img src="${adjustedImgSrc}" alt="${name}">
        <figcaption>${name}</figcaption>
    </a>
`;
      }

      let cardsHTMLArr = [];
      for (let i = 0; i < games.length; ++i) {
        cardsHTMLArr.push(getCardHTML(games[i]));
      }

      const cardsHTMLStr = cardsHTMLArr.join("");

      document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("allGameList").innerHTML = cardsHTMLStr;

        const searchInput = document.querySelector(".search-bar");
        const searchResults = document.getElementById("searchResults");

        if (!searchInput || !searchResults) {
          console.error(
            "Search input or results container not found in the DOM."
          );
          return;
        }

        searchInput.addEventListener("focus", function () {
          updateSearchResults();
        });

        searchInput.addEventListener("input", updateSearchResults);

        document.addEventListener("click", function (event) {
          if (
            !searchInput.contains(event.target) &&
            !searchResults.contains(event.target)
          ) {
            searchResults.style.display = "none";
          }
        });

        function updateSearchResults() {
          const searchText = searchInput.value.toLowerCase();
          const filteredGames = games
            .filter((game) => game.name.toLowerCase().includes(searchText))
            .slice(0, 7);

          searchResults.innerHTML = "";
          if (filteredGames.length === 0) {
            searchResults.style.display = "none";
            return;
          }

          filteredGames.forEach((game) => {
            const { id, imgSrc, name } = game;
            const adjustedHref = `./play/?id=${id}`;
            const adjustedImgSrc = `./img/${imgSrc}`;

            const resultLink = document.createElement("a");
            resultLink.href = adjustedHref;
            resultLink.innerHTML = `
            <img src="${adjustedImgSrc}" alt="${name}">
            <span>${name}</span>
        `;
            searchResults.appendChild(resultLink);
          });

          searchResults.style.display = "block";
        }
      });
    </script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBh-VnGiP4qZD0r14gfn9dr77GwtslpTqU",
        authDomain: "strongdog-auth.firebaseapp.com",
        databaseURL: "https://strongdog-auth-default-rtdb.firebaseio.com",
        projectId: "strongdog-auth",
        storageBucket: "strongdog-auth.appspot.com",
        messagingSenderId: "936276282572",
        appId: "1:936276282572:web:a802b7f609381ff9428669",
        measurementId: "G-0YLTCV2MMS",
      };

      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();
      const rtdb = firebase.database(); // Add this to access Realtime DB
    </script>
    <script src="appscript.js"></script>
    <script>
      function normalizeGameName(name) {
        return name
          .toLowerCase()
          .replace(/\s+/g, "")
          .replace(/[^a-z0-9]/g, "");
      }
      function getTierAndProgressFromXP(xp) {
        const baseXPNeeded = 50; // Starting XP needed
        const increasePerTier = 200; // Fixed increase after cap
        const exponentialMultiplier = 1.2; // Multiplier for exponential increase
        const levelsPerTier = 5; // Levels per tier
        const capTier = 10; // Cap after this many tiers (50 levels total)

        let level = 1;
        let tier = 1;
        let xpNeeded = baseXPNeeded; // Initial XP needed for the first tier

        while (xp >= xpNeeded) {
          xp -= xpNeeded;

          if (tier < capTier) {
            if (level % levelsPerTier === 0) {
              tier++;
              xpNeeded = Math.round(xpNeeded * exponentialMultiplier);
            }
          } else {
            if (level % levelsPerTier === 0) {
              xpNeeded += increasePerTier;
            }
          }

          level++;
        }

        return {
          level,
          tier,
          currentXP: xp,
          xpNeededForNext: xpNeeded,
        };
      }

      document.addEventListener("DOMContentLoaded", function () {
        const topGameList = document.getElementById("topGameList");
        const loadingContainerEl = document.createElement("div");
        loadingContainerEl.className = "loading-container";
        loadingContainerEl.innerHTML = `
          <div class="bars">
            <div class="bar bar-1"></div>
            <div class="bar bar-2"></div>
            <div class="bar bar-3"></div>
            <div class="bar bar-4"></div>
            <div class="bar bar-5"></div>
          </div>
        `;

        topGameList.appendChild(loadingContainerEl);

        function fetchTopGames() {
          fetch(targetUrl, {
            method: "GET",
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error(
                  "Network response was not ok " + response.statusText
                );
              }
              return response.json();
            })
            .then((data) => {
              if (data && data.content) {
                const parsedData = JSON.parse(data.content);
                console.log("Parsed data:", parsedData);
                displayTopGames(parsedData);
              } else {
                console.error("Invalid data format", data);
              }
            })
            .catch((error) => console.error("Error:", error))
            .finally(() => {
              loadingContainerEl.style.display = "none";
            });
        }
        function displayTopGames(games) {
          const topGameList = document.getElementById("topGameList");
          if (!topGameList) {
            console.error("Required element not found.");
            return;
          }

          topGameList.innerHTML = ""; // Clear existing content

          let foundCount = 0;
          let index = 1; // Start after any header row, if present
          const displayedGameNames = new Set(); // Keep track of which games have been displayed

          // Attempt to list up to 20 unique games
          while (foundCount < 20 && index < games.length) {
            const game = games[index];
            const gameName = game[0];
            const matchingCard = findMatchingCard(gameName);

            if (matchingCard) {
              if (!displayedGameNames.has(gameName)) {
                // If we haven't displayed this game yet, display it now
                topGameList.appendChild(matchingCard.cloneNode(true));
                displayedGameNames.add(gameName);
                foundCount++;
              } else {
                // This is a duplicate of a previously displayed game
                // We do nothing here, effectively ignoring this duplicate
              }
            } else {
              console.warn(`Card for "${gameName}" not found, skipping.`);
              // Do not increment foundCount since we didn't display anything
            }

            index++;
          }

          if (foundCount < 20) {
            console.warn("Could not fill all 20 top slots with unique games.");
          }
        }

        function findMatchingCard(gameName) {
          const formattedGameName = normalizeGameName(gameName); // Normalize the gameName from Top 20
          const cards = document.querySelectorAll("#allGameList .card"); // Select all cards

          for (let card of cards) {
            const cardGameId = card.getAttribute("data-game-id"); // Get the data-game-id from the card
            if (cardGameId === formattedGameName) {
              return card; // Return the matching card
            }
          }

          console.warn(`Card not found one of the games.`);
          return null;
        }

        (function () {
          loadingContainerEl.style.display = "flex";
          fetchTopGames();
        })();
      });
    </script>
  </head>
  <body>
    <div
      id="secretLink"
      title="Secret Menu"
      style="
        position: absolute;
        top: 10px;
        right: 10px;
        width: 10px;
        height: 10px;
        cursor: pointer;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      "
    ></div>
    <script>
      window.addEventListener("load", function () {
        const secretLink = document.getElementById("secretLink");
        secretLink.addEventListener("click", function () {
          window.location.href = "secret-menu.html";
        });
      });
    </script>

    <div class="navbar">
      <div class="menu-icon" id="menuIcon">&#9776;</div>
      <a href="index.html" class="logo">StrongDog<span class="xp">XP</span></a>

      <div class="search-container">
        <input
          type="text"
          class="search-bar"
          placeholder="Search for games..."
          id="searchInput"
          autocomplete="off"
        />
        <div class="search-results" id="searchResults"></div>
      </div>
    </div>
    <div class="updates-text-container">
      <p class="updates-paragraph-text">The save manager has been added to strongdog! It is still a work in progress, but from what has been tested it works. To access it go into the sidebar and scroll to the bottom.</p>
    </div>
    <div class="modal" id="popupModal">
      <div class="modal-content">
        <span class="modal-close" id="closeModal">&times;</span>
        <p>
          The strongdog discord server is a place for strongdog users to chill,
          play games together, request ideas, and have fun!
        </p>
        <p>
          If you want to help on StrongDog, there is a chat where you can get
          help downloading games, and you can upload games YOU download to add
          to StrongDog! (And yes, you WILL get credit for downloading games)
        </p>
        <p>
          Ready to join? Click
          <a href="https://discord.gg/pWjfQ4Sz5c" target="_blank">here</a> to
          join the Discord server!
        </p>
      </div>
    </div>
    <h2 style="text-align: center"><strong>Top 20</strong></h2>
    <div class="games-grid" id="topGameList"></div>

    <h2 style="text-align: center"><strong>All</strong></h2>
    <div class="games-grid" id="allGameList"></div>

    <h2 style="text-align: center"><strong>StrongDogXP LLC</strong></h2>

    <div class="news-container">
      <div class="news">
        <div class="credits-item">
          <div class="credits-role">CEO</div>
          <div class="credits-names">
            <a
              href="https://github.com/jman1593"
              target="_blank"
              class="credits-link"
              >Joshua Pettit</a
            >
          </div>
        </div>
        <div class="credits-item">
          <div class="credits-role">Developers</div>
          <div class="credits-names">
            <a
              href="https://github.com/JamesMeadows4"
              target="_blank"
              class="credits-link"
              >James Meadows</a
            >
            <span>|</span>
            <a
              href="https://github.com/jman1593"
              target="_blank"
              class="credits-link"
              >Joshua Pettit</a
            >
          </div>
        </div>
        <div class="credits-item">
          <div class="credits-role">Game Downloaders</div>
          <div class="credits-names">
            <a
              href="https://github.com/jman1593"
              target="_blank"
              class="credits-link"
              >Joshua Pettit</a
            >
            <span>|</span>
            <a
              href="https://maxwellstevenson.com"
              target="_blank"
              class="credits-link"
              >Maxwell Stevenson</a
            >
          </div>
        </div>
        <div class="credits-item">
          <div class="credits-role">Other Links</div>
          <div class="credits-names">
            <a
              href="https://weakcatxp.github.io"
              target="_blank"
              class="credits-link"
              >weakcatxp.github.io</a
            >
            <span>|</span>
            <a
              href="https://strongdogxp.github.io"
              target="_blank"
              class="credits-link"
              >mathcordxp.github.io</a
            >
            <span>|</span>
            <a
              href="https://strongdogxp.github.io"
              target="_blank"
              class="credits-link"
              >strongdogxp.github.io</a
            >
            <span>|</span>
            <a
              href="https://jman1593.github.io"
              target="_blank"
              class="credits-link"
              >jman1593.github.io</a
            >
            <span>|</span>
            <a
              href="https://strongdog-1.vercel.app"
              target="_blank"
              class="credits-link"
              >strongdog-1.vercel.app</a
            >
            <span>|</span>
            <a href="https://mathcord.com" target="_blank" class="credits-link"
              >mathcord.com</a
            >
            <span>|</span>
            <a href="https://strongdog.com" target="_blank" class="credits-link"
              >strongdog.com</a
            >
          </div>
        </div>
        <div class="credits-item">
          <div class="credits-role">MORE UNBLOCKED LINKS ON THE DISCORD</div>
        </div>
      </div>
    </div>
    <div class="slide-menu" id="slideMenu">
      <div class="categories">
        <a href="favs.html" class="option-link">Favorites</a>
        <a href="#" id="randomGame" class="option-link">Random Game</a>
        <a href="#" id="blockLanschool" class="option-link">Block Lanschool</a>
        <a href="about.html" class="option-link">About | Bugs | Request Games</a>
        <a href="./save/" class="option-link">Save manager<span class="new-feature-tag">new</span></a>
        <a href="https://discord.gg/pWjfQ4Sz5c" class="option-link">Discord Server</a>
      </div>
    </div>
    <script type="module">
      import games from "./cards-data.js";

      document.addEventListener("DOMContentLoaded", function () {
        const menuIcon = document.getElementById("menuIcon");
        const slideMenu = document.querySelector(".slide-menu");
        const categories = document.querySelector(".categories");

        menuIcon.addEventListener("click", function (event) {
          event.stopPropagation();
          if (slideMenu.style.transform === "translateX(0%)") {
            slideMenu.style.transform = "translateX(-100%)";
          } else {
            slideMenu.style.transform = "translateX(0%)";
          }
        });

        window.addEventListener("click", function (event) {
          if (event.target !== menuIcon && !slideMenu.contains(event.target)) {
            slideMenu.style.transform = "translateX(-100%)";
          }
        });

        auth.onAuthStateChanged(async (user) => {
          if (user) {
            const userDetailsContainer = document.createElement("div");
            userDetailsContainer.className = "user-details-container";

            const profileTopContainer = document.createElement("div");
            profileTopContainer.className = "profile-top-container";

            const profilePictureContainer = document.createElement("div");
            profilePictureContainer.className = "profile-picture-container";
            const profilePictureElement = document.createElement("img");
            profilePictureElement.className = "profile-picture";
            profilePictureContainer.appendChild(profilePictureElement);

            const usernameContainer = document.createElement("div");
            usernameContainer.className = "username-container";
            const usernameElement = document.createElement("p");
            usernameElement.className = "username-text";
            usernameContainer.appendChild(usernameElement);

            profileTopContainer.appendChild(profilePictureContainer);
            profileTopContainer.appendChild(usernameContainer);

            userDetailsContainer.appendChild(profileTopContainer);

            if (user.photoURL) {
              profilePictureElement.src = user.photoURL;
            } else {
              profilePictureElement.src = "img/default-avatar.png";
            }

            const userId = user.uid;
            const userDocRef = db.collection("usernames").doc(userId);
            const userDoc = await userDocRef.get();

            if (userDoc.exists) {
              const userData = userDoc.data();
              usernameElement.textContent = userData.username || "Username";
            } else {
              usernameElement.textContent = user.displayName || "Username";
            }
            // Fetch total XP from Realtime Database
            const xpRef = rtdb.ref(`xp/${userId}`);
            xpRef.once("value", (snapshot) => {
              let totalXP = 0;
              if (snapshot.exists()) {
                totalXP = snapshot.val();
              } else {
                totalXP = 0;
              }

              // Calculate level, tier, and progress
              const { level, tier, currentXP, xpNeededForNext } =
                getTierAndProgressFromXP(totalXP);

              const xpContainer = document.createElement("div");
              xpContainer.className = "xp-container";

              const xpLevelText = document.createElement("div");
              xpLevelText.className = "xp-level-text";
              xpLevelText.textContent = `Level ${level}`;

              const xpBar = document.createElement("div");
              xpBar.className = "xp-bar";

              const xpBarFill = document.createElement("div");
              xpBarFill.className = "xp-bar-fill";
              const fillPercent = (currentXP / xpNeededForNext) * 100;
              xpBarFill.style.width = `${fillPercent}%`;

              const xpBarText = document.createElement("div");
              xpBarText.className = "xp-bar-text";
              xpBarText.textContent = `${currentXP}/${xpNeededForNext}`;

              xpBar.appendChild(xpBarFill);
              xpBar.appendChild(xpBarText);
              xpContainer.appendChild(xpLevelText);
              xpContainer.appendChild(xpBar);

              userDetailsContainer.appendChild(xpContainer);

              profilePictureContainer.addEventListener("click", () => {
                window.location.href = "settings.html";
              });

              slideMenu.insertBefore(userDetailsContainer, categories);

              const logoutLink = document.createElement("a");
              logoutLink.href = "#";
              logoutLink.className = "option-link";
              logoutLink.textContent = "Log Out";
              logoutLink.style.backgroundColor = "#dc3545";
              logoutLink.style.color = "white";

              logoutLink.addEventListener("click", function (e) {
                e.preventDefault();
                auth
                  .signOut()
                  .then(() => {
                    window.location.reload();
                  })
                  .catch((error) => {
                    console.error("Error signing out:", error);
                  });
              });

              const favoritesLink = categories.querySelector(
                'a[href="favs.html"]'
              );
              categories.insertBefore(logoutLink, favoritesLink);

              try {
                const accessDocRef = db.collection("access").doc(user.uid);
                accessDocRef.get().then((accessDoc) => {
                  if (accessDoc.exists) {
                    const accessData = accessDoc.data();
                    if (accessData.tester === true) {
                      const testGamesLink = document.createElement("a");
                      testGamesLink.href = "test.html";
                      testGamesLink.className = "option-link";
                      testGamesLink.textContent = "Test Games";
                      testGamesLink.style.backgroundColor = "#28a745";
                      testGamesLink.style.color = "white";
                      testGamesLink.style.marginTop = "10px";

                      testGamesLink.addEventListener("mouseover", function () {
                        testGamesLink.style.backgroundColor = "#218838";
                      });
                      testGamesLink.addEventListener("mouseout", function () {
                        testGamesLink.style.backgroundColor = "#28a745";
                      });

                      categories.insertBefore(testGamesLink, favoritesLink);
                    }
                  }
                });
              } catch (error) {
                console.error();
              }
            }); // end xpRef.once
          } else {
            const userDetailsContainer = document.createElement("div");
            userDetailsContainer.className = "user-details-container";

            const notLoggedInContainer = document.createElement("div");
            notLoggedInContainer.className = "username-container";

            const notLoggedInText = document.createElement("p");
            notLoggedInText.className = "username-text";
            notLoggedInText.textContent = "Not logged in";

            notLoggedInContainer.appendChild(notLoggedInText);

            const loginButton = document.createElement("button");
            loginButton.textContent = "Log In";
            loginButton.style.backgroundColor = "#007bff";
            loginButton.style.color = "white";
            loginButton.style.border = "none";
            loginButton.style.padding = "10px 20px";
            loginButton.style.fontSize = "16px";
            loginButton.style.borderRadius = "5px";
            loginButton.style.cursor = "pointer";
            loginButton.style.marginTop = "5px";

            loginButton.addEventListener("click", function () {
              window.location.href = "login.html";
            });

            userDetailsContainer.style.display = "flex";
            userDetailsContainer.style.flexDirection = "column";
            userDetailsContainer.style.alignItems = "center";
            userDetailsContainer.style.paddingBlock = "20px";

            userDetailsContainer.appendChild(notLoggedInContainer);
            userDetailsContainer.appendChild(loginButton);
            slideMenu.insertBefore(userDetailsContainer, categories);
          }

          categories
            .querySelector("#randomGame")
            .addEventListener("click", function (e) {
              e.preventDefault();
              handleRandomGameClick();
            });

          categories
            .querySelector("#blockLanschool")
            .addEventListener("click", function (e) {
              e.preventDefault();
              handleBlockLanschoolClick();
            });

          function handleRandomGameClick() {
            if (games.length > 0) {
              const randomIndex = Math.floor(Math.random() * games.length);
              const randomGamePath = games[randomIndex].href;
              window.location.href = randomGamePath;
            } else {
              console.error("No game paths available for selection.");
            }
          }

          function handleBlockLanschoolClick() {
            var url = window.location.href;
            var newTab = window.open();
            newTab.document.write(`
    <html>
      <body style="margin: 0; height: 100vh;">
        <iframe src="${url}" style="border: none; width: 100%; height: 100%;"></iframe>
      </body>
    </html>
  `);
            newTab.document.close();
          }
        });
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const discordLink = document.getElementById("discordLink");
        const modal = document.getElementById("popupModal");
        const closeModal = document.getElementById("closeModal");

        if (discordLink) {
          discordLink.addEventListener("click", function () {
            modal.style.display = "flex";
          });
        }

        if (closeModal) {
          closeModal.addEventListener("click", function () {
            modal.style.display = "none";
          });
        }

        window.addEventListener("click", function (event) {
          if (event.target === modal) {
            modal.style.display = "none";
          }
        });
      });
    </script>
    <script type="module">
      import games from "./cards-data.js";
      import { siteMapping } from "./site-mapping.js";

      document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.querySelector(".search-bar");
        const searchResults = document.getElementById("searchResults");

        if (!searchInput || !searchResults) {
          console.error("Search input or results container not found.");
          return;
        }

        searchInput.addEventListener("focus", updateSearchResults);
        searchInput.addEventListener("input", updateSearchResults);

        document.addEventListener("click", function (event) {
          if (
            !searchInput.contains(event.target) &&
            !searchResults.contains(event.target)
          ) {
            searchResults.style.display = "none";
          }
        });

        function updateSearchResults() {
          const searchText = searchInput.value.toLowerCase();
          const filteredGames = games
            .filter((game) => game.name.toLowerCase().includes(searchText))
            .slice(0, 7);

          searchResults.innerHTML = "";
          if (filteredGames.length === 0) {
            searchResults.style.display = "none";
            return;
          }

          const currentURL = window.location.href;
          let matchedKey = null;

          for (const key in siteMapping) {
            if (currentURL.includes(key)) {
              matchedKey = key;
              break;
            }
          }

          if (!matchedKey) {
            console.warn(
              `No site mapping found for current URL: ${currentURL}`
            );
          }

          filteredGames.forEach((game) => {
            const { id, imgSrc, name, page } = game;
            const adjustedHref = `./play/?id=${id}`; // Only updated the href to use the game ID
            let adjustedImgSrc = `./img/${imgSrc}`;

            if (page >= 2 && matchedKey) {
              const pageIndex = page - 2;
              const pageBaseURLs = siteMapping[matchedKey];

              if (pageBaseURLs && pageIndex < pageBaseURLs.length) {
                const pageBaseURL = pageBaseURLs[pageIndex];
                const adjustedImgPath = imgSrc.replace(/^\.\//, "");
                adjustedImgSrc = `${pageBaseURL}/img/${adjustedImgPath}`;
              } else {
                console.warn(
                  `No site mapping found for page ${page} on hostname: ${matchedKey}`
                );
              }
            }

            const resultLink = document.createElement("a");
            resultLink.href = adjustedHref;
            resultLink.innerHTML = `
            <img src="${adjustedImgSrc}" alt="${name}">
            <span>${name}</span>
        `;
            searchResults.appendChild(resultLink);
          });

          searchResults.style.display = "block";
        }
      });
    </script>
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const page1Link = document.getElementById("page1-link");
      const page2Link = document.getElementById("page2-link");
      const hostname = window.location.hostname;

      const linkMap = {
        "jman1593.github.io": { page1: "/#", page2: "/strongdog2/index.html" },
        "strongdog-1.vercel.app": {
          page1: "https://strongdog-1.vercel.app",
          page2: "https://strongdog2.vercel.app",
        },
        "strongdog2.vercel.app": {
          page1: "https://strongdog-1.vercel.app",
          page2: "https://strongdog2.vercel.app",
        },
        "strongdog.netlify.app": {
          page1: "https://strongdog.netlify.app",
          page2: "https://strongdog2.netlify.app",
        },
        "strongdog2.netlify.app": {
          page1: "https://strongdog.netlify.app",
          page2: "https://strongdog2.netlify.app",
        },
        "mathcord.netlify.app": {
          page1: "https://mathcord.netlify.app",
          page2: "https://mathcord2.netlify.app",
        },
        "mathcord2.netlify.app": {
          page1: "https://mathcord.netlify.app",
          page2: "https://mathcord2.netlify.app",
        },
        "strongdog.onrender.com": {
          page1: "https://strongdog.onrender.com",
          page2: "https://strongdog2.onrender.com",
        },
        "stroongdog.netlify.app": {
          page1: "https://stroongdog.netlify.app",
          page2: "https://stroongdog2.netlify.app",
        },
        "stroongdog2.netlify.app": {
          page1: "https://stroongdog.netlify.app",
          page2: "https://stroongdog2.netlify.app",
        },
      };

      for (const key in linkMap) {
        if (hostname.includes(key)) {
          page1Link.href = linkMap[key].page1;
          page2Link.href = linkMap[key].page2;
          break;
        }
      }
    });
  </script>
  <script>
    document
      .getElementById("secretLink")
      .addEventListener("click", function () {
        window.location.href = "secret-menu.html";
      });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const discordLink = document.getElementById("discordLink");
      const modal = document.getElementById("popupModal");
      const closeModal = document.getElementById("closeModal");

      if (discordLink) {
        discordLink.addEventListener("click", function () {
          modal.style.display = "flex";
        });
      }

      if (closeModal) {
        closeModal.addEventListener("click", function () {
          modal.style.display = "none";
        });
      }

      window.addEventListener("click", function (event) {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      });
    });
  </script>
  <script type="module">
    import games from "./cards-data.js";

    document.addEventListener("DOMContentLoaded", function () {
      const randomGameButton = document.getElementById("randomGame");

      function handleRandomGameClick() {
        if (games.length > 0) {
          const randomIndex = Math.floor(Math.random() * games.length);
          const randomGamePath = games[randomIndex].href;
          window.location.href = randomGamePath;
        } else {
          console.error("No game paths available for selection.");
        }
      }

      if (randomGameButton) {
        randomGameButton.addEventListener("click", function (event) {
          event.preventDefault();
          handleRandomGameClick();
        });
      }
    });
  </script>
</html>
